# 主机租赁接口

### 接口调用概述

​          调用前提:根据接入指南获取到相对应的token进行接口调用

​		  接入流程图参考:

​			[![piSKwhq.md.png](https://z1.ax1x.com/2023/10/12/piSKwhq.md.png)](https://imgse.com/i/piSKwhq)

- 步骤一:根据接入指南完成账号配置获取到调用的token
- 步骤二:查询主机和镜像的信息获取到imageId和packageId
- 步骤三:根据上一步获取到的id去创建主机(分为按量和包时，需要保证钱包余额充足)
- 步骤四:创建主机后可调用主机相关接口，包括开关机、重启、删除、查询操作



#### 1. 镜像信息

**Path**

`GET`   `v1/pve/open/image`

**Request paramerter**

| Parameter           | Description | Required | Type   | Location |
| ------------------- | ----------- | -------- | ------ | -------- |
| Finovy-Access-Token | 令牌-口令   | yes      | string | header   |

**Response Type**:application/json

**Response Example**

```json
{
  "code":0,
  "data":[
       {
            "imageId": "4005",
            "type": "BL",
            "systemImageName": "Ubuntu Server",
            "systemImageVersion": "20.04 x64"
        }
  ],
  "msg":"success",
  "traceId":"xxxxxxxxxxxxxx"
}
```

| Responses Parameter | Description  | Type   |
| :------------------ | :----------- | ------ |
| imageId             | 镜像ID       | string |
| type                | 镜像类型     | string |
| systemImageName     | 镜像系统     | string |
| systemImageVersion  | 镜像系统版本 | string |



#### 2. 主机模板信息

**Path**

`GET`   `v1/pve/open/packAge/{type}`

**Request paramerter**

| Parameter           | Description                | Required | Type   | Location |
| ------------------- | -------------------------- | -------- | ------ | -------- |
| Finovy-Access-Token | 令牌-口令                  | yes      | string | header   |
| type                | 模板类型（0按量、1包时段） | yes      | string | path     |

**Response Type**:application/json

**Response Example**

```json
{
    "code":0,
    "data":[
     {
            "packageId": "Wy1KiMqtPO",
            "name": "T使用---显卡*1",
            "gpuNumber": 1,
            "memoryNumber": 4,
            "rigidDiskNumber": 128,
            "amount": 1.10,
            "cpuNumber": 4,
            "bandWidth": 30,
            "type": "ceph",
            "pve_machine_type": "1",
            "area": "0",
            "use_type": "2",
            "discount": 1.00
        }
    ],
    "msg":"success",
    "traceId":"xxxxxxxxxxxxxx"
}
```

| Responses Parameter | Description                                                  | Type   |
| ------------------- | ------------------------------------------------------------ | ------ |
| packageId           | 主机模板ID                                                   | string |
| name                | 主机模板名称                                                 | string |
| gpuNumber           | GPU数                                                        | int    |
| memoryNumber        | 内存数                                                       | int    |
| rigid_disk_number   | 硬盘数                                                       | int    |
| cpuNumber           | cpu数                                                        | int    |
| band_width          | 带宽                                                         | int    |
| amount              | 金额                                                         | string |
| discount            | 折扣                                                         | string |
| type                | 主机模板类型                                                 | string |
| pveMachineType      | 主机用途（0普通办公、1图像处理、2算法区域）                  | string |
| area                | 数据中心（0华南、1华西、2国际）                              | string |
| useType             | 主机使用类型（0仅支持按量、1仅支持包时段、2支持按量和包时段） | string |







#### 3. 创建按量主机

**Path**

`POST`   `v1/pve/open/createquantity`

**Request paramerter**

| Parameter           | Description                                  | Required | Type   | Location |
| ------------------- | -------------------------------------------- | -------- | ------ | -------- |
| Finovy-Access-Token | 令牌-口令                                    | yes      | string | header   |
| packageId           | 主机模板ID（主机模板type需要和镜像type一致） | yes      | string | body     |
| imageId             | 镜像ID（镜像type需要和主机模板type一致）     | yes      | string | body     |

**Response Type**:application/json

**Response Example**

```json
{
    "code":0,
    "data":true,
    "msg":"success",
    "traceId":"xxxxxxxxxxxxxx"
}
```

**code**

| 错误码 | 错误描述                     |
| ------ | ---------------------------- |
| 1001   | 权限不足                     |
| 7005   | 主机模板类型与镜像类型不一致 |

#### 4. 创建包时段主机

**Path**

`POST`   `v1/pve/open/createRent`

**Request paramerter**

| Parameter           | Description                                      | Required | Type   | Location |
| ------------------- | ------------------------------------------------ | -------- | ------ | -------- |
| Finovy-Access-Token | 令牌-口令                                        | yes      | string | header   |
| packageId           | 主机模板ID（主机模板type需要和镜像type一致）     | yes      | string | body     |
| imageId             | 镜像ID（镜像type需要和主机模板type一致）         | yes      | string | body     |
| periodNumber        | 购买周期                                         | yes      | int    | body     |
| periodType          | 购买周期类型（0小时、1日、2周、3月、4季度、5年） | yes      | int    | body     |

**Response Type**:application/json

**Response Example**

```json
{
    "code":0,
    "data":"dyMFQQgHIW",
    "msg":"success",
    "traceId":"xxxxxxxxxxxxxx"
}
```

| Responses Parameter | Description | Type   |
| ------------------- | ----------- | ------ |
| data                | 主机ID      | string |

**code**

| 错误码 | 错误描述                     |
| ------ | ---------------------------- |
| 1001   | 权限不足                     |
| 1037   | 未进行实名认证               |
| 6002   | 资源不足, 请重新选择配置     |
| 6005   | 创建等待                     |
| 7005   | 主机模板类型与镜像类型不一致 |
| 9000   | 钱包异常                     |
| 9001   | 钱包余额不足                 |

#### 5. 开机/关机

**Path**

`GET`   `v1/pve/open/operate/{id}`

**Request paramerter**

| Parameter           | Description                     | Required | Type   | Location |
| ------------------- | ------------------------------- | -------- | ------ | -------- |
| Finovy-Access-Token | 令牌-口令                       | yes      | string | header   |
| id                  | 主机ID                          | yes      | string | path     |
| type                | 0：关闭虚拟机     1：开启虚拟机 | yes      | string | query    |

**Response Type**:application/json

**Response Example**

```json
{
    "code":0,
    "data":true,
    "msg":"success",
    "traceId":"xxxxxxxxxxxxxx"
}
```

**code**

| 错误码 | 错误描述                 |
| ------ | ------------------------ |
| 1001   | 权限不足                 |
| 6000   | 开机中                   |
| 6001   | 关机中                   |
| 6002   | 资源不足, 请重新选择配置 |
| 6003   | 钱包余额不足             |

#### 6. 重启

**Path**

`GET `   `v1/pve/open/reboot/{id}`

**Request paramerter**

| Parameter           | Description | Required | Type   | Location |
| ------------------- | ----------- | -------- | ------ | -------- |
| Finovy-Access-Token | 令牌-口令   | yes      | string | header   |
| id                  | 主机ID      | yes      | string | path     |

**Response Type**:application/json

**Response Example**

```json
{
    "code":0,
    "data":true,
    "msg":"success",
    "traceId":"xxxxxxxxxxxxxx"
}
```

**code**

| 错误码 | 错误描述               |
| ------ | ---------------------- |
| 7002   | 未启动的主机不能重启   |
| 7003   | 虚拟机不可用，不能重启 |
| 7004   | 主机未运行，不能重启   |

#### 7. 查询虚拟机信息

**Path**

`GET `   `v1/pve/open/one/{id}`

**Request paramerter**

| Parameter           | Description | Required | Type   | Location |
| ------------------- | ----------- | -------- | ------ | -------- |
| Finovy-Access-Token | 令牌-口令   | yes      | string | header   |
| id                  | 主机ID      | yes      | string | path     |

**Response Type**:application/json

**Response Example**

```JSON
{
    "code":0,
    "data":{
        "id": "rEJjwEY5Wt",
        "name": "渲大师rEJjwEY5Wt",
        "gpuConfiguration": "-",
        "gpuNumber": null,
        "memory": 16,
        "cpu": 4,
        "rigidDisk": 128,
        "operatingSystem": "Windows",
        "hostAccount": "root",
        "hostPw": "EYAHeOJi",
        "useType": "0",
        "address": "gx-xds-rdp.songmao-idc.com",
        "port": 54220,
        "mac": null,
        "ipv4": null,
        "pveMachineType": "0",
        "createTime": 1692071029000,
        "expirationTime": null
    },
    "msg":"success",
    "traceId":"xxxxxxxxxxxxxx"
}
```

| Responses Parameter | Description                                                 | Type   |
| :------------------ | :---------------------------------------------------------- | ------ |
| id                  | 主机ID                                                      | string |
| name                | 主机名称                                                    | string |
| gpuConfiguration    | GPU配置                                                     | string |
| gpuNumber           | GPU数量                                                     | int    |
| memory              | 内存数                                                      | int    |
| cpu                 | cpu核数                                                     | int    |
| rigidDisk           | 硬盘数                                                      | int    |
| operatingSystem     | 操作系统（Windows,Windows Server,Ubuntu Server,Debian）     | string |
| hostAccount         | 用户名（登录用户名）                                        | string |
| address             | 主机连接地址                                                | string |
| port                | 主机连接端口                                                | int    |
| pveMachineType      | 主机使用范围，用途（0：普通办公、1：图像处理、2：算法区域） | string |
| createTime          | 主机创建时间                                                | long   |
| expirationTime      | 主机到期时间，有可能为空                                    | long   |
| mac                 | MAC地址                                                     | string |
| ipv4                | ip地址                                                      | string |
| useType             | 主机类型（0按量，1包时段）                                  | string |

#### 8. 批量查询虚拟机信息

**Path**

`GET`   `v1/pve/open/mypage`

**Request paramerter**

| Parameter           | Description                    | Required | Type    | Location |
| ------------------- | ------------------------------ | -------- | ------- | -------- |
| Finovy-Access-Token | 令牌-口令                      | yes      | string  | header   |
| page                | 起始页                         | yes      | integer | query    |
| pageSize            | 页大小，单次最多只支持查询25条 | yes      | integer | query    |

**Response Type**:application/json

**Response Example**

```json
{
    "code":0,
    "data":{"data":
    [
        {
                "id": "OWWWuy7Gcj",
                "name": "渲大师OWWWuy7Gcj",
                "gpuConfiguration": "-",
                "gpuNumber": null,
                "memory": 8,
                "cpu": 2,
                "rigidDisk": 80,
                "operatingSystem": "Windows",
                "hostAccount": "root",
                "hostPw": "cWf4psCY",
                "useType": "1",
                "address": "",
                "port": 0,
                "pveMachineType": "0",
                "createTime": 1692350230000,
                "expirationTime": 1692436630000
            },
            {
                "id": "arpFxoBgGp",
                "name": "渲大师arpFxoBgGp",
                "gpuConfiguration": "-",
                "gpuNumber": null,
                "memory": 8,
                "cpu": 2,
                "rigidDisk": 500,
                "operatingSystem": "Windows",
                "hostAccount": null,
                "hostPw": null,
                "useType": "0",
                "address": null,
                "port": null,
                "pveMachineType": "0",
                "createTime": 1692350025000,
                "expirationTime": null
            }
    ],
    "totalCounts":2
 },
    "msg":"success",
    "traceId":"xxxxxxxxxxxxxx"
}
```

| Responses Parameter | Description                                                 | Type   |
| :------------------ | :---------------------------------------------------------- | ------ |
| id                  | 主机ID                                                      | string |
| name                | 主机名称                                                    | string |
| gpuConfiguration    | GPU配置                                                     | string |
| gpuNumber           | GPU数量                                                     | int    |
| memory              | 内存数                                                      | int    |
| cpu                 | cpu核数                                                     | int    |
| rigidDisk           | 硬盘数                                                      | int    |
| operatingSystem     | 操作系统（Windows,Windows Server,Ubuntu Server,Debian）     | string |
| hostAccount         | 用户名（登录用户名）                                        | string |
| address             | 主机连接地址                                                | string |
| port                | 主机连接端口                                                | int    |
| pveMachineType      | 主机使用范围，用途（0：普通办公、1：图像处理、2：算法区域） | string |
| createTime          | 主机创建时间                                                | long   |
| expirationTime      | 主机到期时间，有可能为空                                    | long   |
| useType             | 主机类型（0按量，1包时段）                                  | string |

#### 9. 删除虚拟机

**Path**

`DELETE`   `v1/pve/open/delete/{id}`

**Response Type**:application/json

**Request paramerter**

| Parameter           | Description | Required | Type   | Location |
| ------------------- | ----------- | -------- | ------ | -------- |
| Finovy-Access-Token | 令牌-口令   | yes      | string | header   |
| id                  | 主机ID      | yes      | string | path     |

**Response Example**

```json
{
    "code":0,
    "data":true,
    "msg":"success",
    "traceId":"xxxxxxxxxxxxxx"
}
```

**code**

| 错误码 | 错误描述 |
| ------ | -------- |
| 1001   | 权限不足 |

#### 

#### 
